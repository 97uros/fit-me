<div class="container mx-auto px-4 py-4 mb-10 lg:mb-0">
  <div class="flex flex-col-reverse md:flex-row gap-4 my-6">
    <div class="w-full flex flex-col lg:w-1/3 h-1/2 text-white gap-4">
      <ng-container *ngFor="let day of days">
        <div *ngIf="day && scheduledWorkouts[day.toDateString()]">
          <div 
            class="w-full flex justify-between items-center bg-gray-800 text-white rounded-xl p-4 capitalize" 
            *ngFor="let workout of scheduledWorkouts[day.toDateString()]"
            [ngClass]="{'bg-emerald-700': hoveredDate === day.toDateString()}">
            {{ workout.name }} <br> 
            {{ day.getDate() }}.{{ day.getMonth() }}.{{ day.getFullYear() }} at {{ workout.scheduledTime }}
            <div class="buttons flex gap-2 lg:gap-4">
              <button (click)="startWorkout(workout)" class="flex justify-center items-center my-2 bg-gray-700 border-2 border-green-600 text-white font-bold uppercase px-4 py-2 rounded-full h-10 w-10">
                <i class="fa-solid fa-play text-gray-400 hover:text-white"></i>
              </button>
              <button (click)="deleteWorkoutFromDate(day, workout.id)" class="flex justify-center items-center my-2 border-2 border-red-600 text-white font-bold uppercase px-4 py-2 rounded-full h-10 w-10">
                <i class="fa-solid fa-trash text-gray-400 hover:text-white"></i>
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <div class="flex-1 w-full lg:w-2/3 h-1/2 lg:h-full rounded-xl shadow-lg bg-gray-800 text-white p-4 font-semibold text-center">
      <div class="flex items-center justify-around p-6">
        <button (click)="changeMonth(-1)" class="flex justify-center items-center p-4 rounded-full w-10 h-10 bg-gray-700 600 text-white">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="text-lg">{{ monthName }}, {{ year }}</div>
        <button (click)="changeMonth(1)" class="flex justify-center items-center p-4 rounded-full w-10 h-10 bg-gray-700 600 text-white">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
      <div class="grid grid-cols-7 grid-col-dense grid-rows-6 gap-1">
        <div class="text-white">Sun</div>
        <div class="text-white">Mon</div>
        <div class="text-white">Tue</div>
        <div class="text-white">Wed</div>
        <div class="text-white">Thu</div>
        <div class="text-white">Fri</div>
        <div class="text-white">Sat</div>
        <ng-container *ngFor="let day of days">
          <button class="text-center hover:bg-gray-700 cursor-pointer w-11 h-10 lg:w-full lg:h-14" 
            [ngClass]="getDayClasses(day)" 
            (click)="selectDate(day)"
            [disabled]="isPastDay(day)">
            
            {{ day ? day.getDate() : '' }}
        
            <!-- Display check icon if the day has a finished workout -->
            <div class="absolute" *ngIf="day && hasFinishedWorkoutOnDate(day)" 
                (mouseenter)="showFinishedWorkoutTooltip(day)"
                (mouseleave)="hideFinishedWorkoutTooltip()">
                <div class="relative bottom-11 lg:bottom-12">
                <i class="fa fa-check-circle text-green-600"></i>
              </div>
            </div>

             <!-- Missed Workout Indicator -->
            <div class="absolute" *ngIf="day && hasMissedWorkoutOnDate(day)">
              <i class="fa fa-exclamation-circle text-red-600"></i>
              <div class="relative bottom-11 lg:bottom-12">
                <i class="fa fa-exclamation-circle text-red-600"></i>
              </div>
            </div>
        
            <!-- Display pulsating circles for scheduled workouts -->
            <div class="absolute" *ngIf="day && scheduledWorkouts[day.toDateString()]">
              <div class="flex justify-center gap-1">
                <span class="relative flex h-3 w-3"
                  *ngFor="let workout of scheduledWorkouts[day.toDateString()]" 
                  (mouseenter)="showScheduledWorkoutTooltip(workout)"
                  (mouseleave)="hideScheduledWorkoutTooltip()">
                  
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-amber-400"></span>
                </span>
              </div>
            </div>
          </button>
        </ng-container>
        <!-- Tooltip for Finished Workout -->
        <div *ngIf="hoveredFinishedWorkout" class="tooltip absolute bg-black text-white p-2 rounded-lg">
          {{ hoveredFinishedWorkout.name }} done at {{ hoveredFinishedWorkoutTime | date: 'shortTime' }}
        </div>
        <!-- Tooltip for Scheduled Workout -->
        <div *ngIf="hoveredScheduledWorkout" class="tooltip absolute bg-black text-white p-2 rounded-lg">
          {{ hoveredScheduledWorkout.name }} scheduled for {{ hoveredScheduledWorkout.scheduledTime }}
        </div>
      </div>
    </div>
    <!-- Workout Selection Modal -->
    <div *ngIf="selectedDate" class="fixed inset-0 z-50 flex items-center justify-center">
      <div class="bg-black/90 text-white rounded-lg shadow-lg p-8 relative max-w-4xl w-full z-50">
        <h2 class="text-2xl font-bold mb-4">Add Workout to {{ selectedDate | date:'fullDate' }}</h2>
        <select [(ngModel)]="selectedWorkout" class="w-full p-2 rounded-md bg-gray-700 text-white">
          <option *ngFor="let workout of workouts" [ngValue]="workout">{{ workout.name }}</option>
        </select>
        <!-- Debugging output -->
        <div *ngIf="!workouts.length">
          <p>No workouts available.</p>
        </div>
        <input type="time" [(ngModel)]="selectedTime" class="w-full mt-4 p-2 rounded-md bg-gray-700 text-white">
        <div class="flex justify-end gap-4 mt-4">
          <button (click)="addWorkoutToDate()" class="bg-green-600 text-white font-bold px-4 py-2 rounded-lg">
            Add Workout
          </button>
          <button (click)="cancelSelection()" class="bg-gray-400/50 text-white font-bold px-4 py-2 rounded-lg">
            Cancel
          </button>
        </div>
        <button class="absolute top-4 right-4 text-white text-2xl" (click)="cancelSelection()"><i class="fa-solid fa-x"></i></button>
      </div>
      <div class="fixed inset-0 bg-black opacity-50 z-40" (click)="cancelSelection()"></div>
    </div>
  </div>
</div>
